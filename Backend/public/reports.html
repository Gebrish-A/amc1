<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports & Analytics - Media Coverage System</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --light-color: #f8f9fa;
            --border-radius: 12px;
            --box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fb;
            padding-top: 56px;
            min-height: 100vh;
        }
        
        .main-content {
            min-height: calc(100vh - 56px);
            padding: 20px;
        }
        
        /* Navigation */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%) !important;
            box-shadow: 0 4px 20px rgba(67, 97, 238, 0.15);
        }
        
        /* Stat Cards */
        .stat-card {
            border-left: 4px solid;
            border-radius: var(--border-radius);
            transition: var(--transition);
            box-shadow: var(--box-shadow);
            border: none;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }
        
        .stat-card.total { border-left-color: var(--primary-color); }
        .stat-card.success { border-left-color: var(--success-color); }
        .stat-card.warning { border-left-color: var(--warning-color); }
        .stat-card.danger { border-left-color: var(--danger-color); }
        .stat-card.info { border-left-color: var(--info-color); }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }
        
        /* Cards */
        .card {
            border: none;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            margin-bottom: 1.5rem;
        }
        
        .card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            background: white;
            border-bottom: 1px solid #eee;
            padding: 1.25rem 1.5rem;
            font-weight: 600;
            border-radius: var(--border-radius) var(--border-radius) 0 0 !important;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        /* Tables */
        .table {
            margin-bottom: 0;
        }
        
        .table thead th {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        
        .table tbody tr {
            transition: var(--transition);
        }
        
        .table tbody tr:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        /* Badges */
        .badge {
            font-weight: 500;
            padding: 0.35em 0.65em;
        }
        
        /* Date Range Picker */
        .daterangepicker {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-overlay.show {
            display: flex;
        }
        
        /* Toast Container */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9998;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .card-body {
                padding: 1.25rem;
            }
            
            .chart-container {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation (Inline) -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="dashboard.html">
                <i class="bi bi-camera-reels me-2"></i>
                <strong>Amhara Media</strong>
                <small class="d-none d-lg-inline ms-lg-2 text-white-50">Reports</small>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="content.html">Content</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Reports</a>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-light ms-2" href="#" onclick="logout()">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center">
            <div class="spinner-border text-light mb-3" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-white">Generating report...</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <main class="main-content">
        <div class="container-fluid">
            <!-- Page Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h2 class="fw-bold mb-1">Reports & Analytics</h2>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="dashboard.html">Dashboard</a></li>
                                    <li class="breadcrumb-item active">Reports</li>
                                </ol>
                            </nav>
                        </div>
                        <div class="d-flex gap-2">
                            <div class="input-group" style="width: 250px;">
                                <span class="input-group-text">
                                    <i class="bi bi-calendar"></i>
                                </span>
                                <input type="text" class="form-control" id="dateRangePicker" 
                                       placeholder="Select date range">
                            </div>
                            <button class="btn btn-outline-primary" onclick="showFilterModal()">
                                <i class="bi bi-funnel me-1"></i>Filter
                            </button>
                            <div class="dropdown">
                                <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="bi bi-download me-1"></i>Export
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" onclick="exportReport('pdf')">PDF Report</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportReport('excel')">Excel Data</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="exportReport('csv')">CSV Data</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row g-3 mb-4">
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <div class="card stat-card total border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="text-muted mb-2">Total Requests</h6>
                            <h3 class="mb-0" id="statTotalRequests">0</h3>
                            <small class="text-success">
                                <i class="bi bi-arrow-up me-1"></i>Loading...
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <div class="card stat-card success border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="text-muted mb-2">Completed</h6>
                            <h3 class="mb-0" id="statCompleted">0</h3>
                            <small class="text-success">
                                <i class="bi bi-check-circle me-1"></i>Loading...
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <div class="card stat-card warning border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="text-muted mb-2">Avg. Response Time</h6>
                            <h3 class="mb-0" id="statResponseTime">0h</h3>
                            <small class="text-warning">
                                <i class="bi bi-clock me-1"></i>Loading...
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <div class="card stat-card danger border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="text-muted mb-2">Overdue</h6>
                            <h3 class="mb-0" id="statOverdue">0</h3>
                            <small class="text-danger">
                                <i class="bi bi-exclamation-triangle me-1"></i>Loading...
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <div class="card stat-card info border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="text-muted mb-2">Resource Usage</h6>
                            <h3 class="mb-0" id="statResourceUsage">0%</h3>
                            <small class="text-info">
                                <i class="bi bi-pie-chart me-1"></i>Loading...
                            </small>
                        </div>
                    </div>
                </div>
                <div class="col-xl-2 col-md-4 col-sm-6">
                    <div class="card stat-card total border-0 shadow-sm">
                        <div class="card-body">
                            <h6 class="text-muted mb-2">Content Uploaded</h6>
                            <h3 class="mb-0" id="statContentUploaded">0</h3>
                            <small class="text-success">
                                <i class="bi bi-cloud-upload me-1"></i>Loading...
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div class="row g-4 mb-4">
                <div class="col-xl-8">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Coverage Requests Trend</h6>
                            <div class="btn-group btn-group-sm">
                                <button type="button" class="btn btn-outline-primary active" onclick="updateChartPeriod('week')">Week</button>
                                <button type="button" class="btn btn-outline-primary" onclick="updateChartPeriod('month')">Month</button>
                                <button type="button" class="btn btn-outline-primary" onclick="updateChartPeriod('quarter')">Quarter</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="requestsTrendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0">
                            <h6 class="mb-0">Request Categories</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="categoriesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row 2 -->
            <div class="row g-4 mb-4">
                <div class="col-xl-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0">
                            <h6 class="mb-0">Performance Metrics</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="performanceChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-header bg-white border-0">
                            <h6 class="mb-0">Resource Utilization</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="utilizationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Reports -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white border-0">
                            <h6 class="mb-0">Detailed Performance Report</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="performanceTable">
                                    <thead>
                                        <tr>
                                            <th>Department</th>
                                            <th>Total Requests</th>
                                            <th>Completed</th>
                                            <th>Avg. Time</th>
                                            <th>Success Rate</th>
                                            <th>Resource Usage</th>
                                            <th>Content Output</th>
                                            <th>Score</th>
                                        </tr>
                                    </thead>
                                    <tbody id="performanceTableBody">
                                        <!-- Performance data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Filter Modal -->
    <div class="modal fade" id="filterModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Report Filters</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="reportFilterForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Date Range</label>
                                    <input type="text" class="form-control" id="filterDateRange">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Department</label>
                                    <select class="form-select" id="filterDepartment" multiple>
                                        <option value="news">News</option>
                                        <option value="sports">Sports</option>
                                        <option value="entertainment">Entertainment</option>
                                        <option value="politics">Politics</option>
                                        <option value="culture">Culture</option>
                                        <option value="business">Business</option>
                                        <option value="technical">Technical</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Request Category</label>
                                    <select class="form-select" id="filterCategory" multiple>
                                        <option value="breaking_news">Breaking News</option>
                                        <option value="sports">Sports</option>
                                        <option value="politics">Politics</option>
                                        <option value="culture">Culture</option>
                                        <option value="entertainment">Entertainment</option>
                                        <option value="business">Business</option>
                                        <option value="health">Health</option>
                                        <option value="education">Education</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Priority Level</label>
                                    <select class="form-select" id="filterPriority" multiple>
                                        <option value="high">High</option>
                                        <option value="medium">Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Report Type</label>
                                    <select class="form-select" id="reportType">
                                        <option value="summary">Summary Report</option>
                                        <option value="detailed">Detailed Report</option>
                                        <option value="comparative">Comparative Analysis</option>
                                        <option value="forecast">Forecast Report</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Metrics</label>
                                    <select class="form-select" id="reportMetrics" multiple>
                                        <option value="requests">Requests Volume</option>
                                        <option value="response_time">Response Time</option>
                                        <option value="completion_rate">Completion Rate</option>
                                        <option value="resource_usage">Resource Usage</option>
                                        <option value="content_output">Content Output</option>
                                        <option value="cost_efficiency">Cost Efficiency</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline-primary" onclick="resetFilters()">Reset</button>
                    <button type="button" class="btn btn-primary" onclick="generateCustomReport()">Generate Report</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Schedule Modal -->
    <div class="modal fade" id="scheduleModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Schedule Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="scheduleForm">
                        <div class="mb-3">
                            <label class="form-label">Report Name *</label>
                            <input type="text" class="form-control" id="scheduleName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Frequency *</label>
                            <select class="form-select" id="scheduleFrequency" required>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Recipients *</label>
                            <select class="form-select" id="scheduleRecipients" multiple required>
                                <option value="all_editors">All Editors</option>
                                <option value="all_managers">All Managers</option>
                                <option value="department_heads">Department Heads</option>
                                <option value="admin">Administrators</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Format</label>
                            <select class="form-select" id="scheduleFormat">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel</option>
                                <option value="both">Both</option>
                            </select>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="scheduleActive">
                            <label class="form-check-label" for="scheduleActive">Active Schedule</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveSchedule()">Save Schedule</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery (for date range picker) -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    
    <!-- Moment.js (for date handling) -->
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    
    <!-- Date Range Picker -->
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.css">
    
    <script>
        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            if (!checkAuth()) {
                window.location.href = 'login.html';
                return;
            }
            
            // Initialize reports
            initializeReports();
        });
        
        // ===== AUTHENTICATION =====
        function checkAuth() {
            const session = JSON.parse(localStorage.getItem('userSession') || sessionStorage.getItem('userSession') || 'null');
            return session && session.isLoggedIn;
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');
                window.location.href = 'login.html';
            }
        }
        
        // ===== REPORTS INITIALIZATION =====
        function initializeReports() {
            // Initialize date range picker
            initializeDatePicker();
            
            // Load statistics
            loadStatistics();
            
            // Initialize charts
            initializeCharts();
            
            // Load performance table
            loadPerformanceTable();
        }
        
        function initializeDatePicker() {
            // Set default date range (last 30 days)
            const startDate = moment().subtract(30, 'days');
            const endDate = moment();
            
            $('#dateRangePicker').daterangepicker({
                startDate: startDate,
                endDate: endDate,
                ranges: {
                    'Today': [moment(), moment()],
                    'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                },
                opens: 'left'
            }, function(start, end, label) {
                console.log('New date range selected: ' + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
                updateReports();
            });
            
            // Initialize filter modal date picker
            $('#filterDateRange').daterangepicker({
                startDate: startDate,
                endDate: endDate,
                opens: 'left'
            });
        }
        
        // ===== STATISTICS =====
        function loadStatistics() {
            // Get data from localStorage
            const requests = JSON.parse(localStorage.getItem('coverageRequests') || '[]');
            const content = JSON.parse(localStorage.getItem('contentLibrary') || '[]');
            
            // Calculate statistics
            const totalRequests = requests.length;
            const completedRequests = requests.filter(r => r.status === 'completed' || r.status === 'approved').length;
            const overdueRequests = requests.filter(r => {
                if (!r.deadline) return false;
                const deadline = new Date(r.deadline);
                return deadline < new Date() && (r.status === 'pending' || r.status === 'in_progress');
            }).length;
            
            // Calculate average response time (simulated)
            const avgResponseTime = requests.length > 0 ? 
                Math.floor(Math.random() * 24) + 1 : 0;
            
            // Calculate resource usage (simulated)
            const resourceUsage = Math.floor(Math.random() * 30) + 60; // 60-90%
            
            // Update UI
            document.getElementById('statTotalRequests').textContent = totalRequests;
            document.getElementById('statCompleted').textContent = completedRequests;
            document.getElementById('statResponseTime').textContent = avgResponseTime + 'h';
            document.getElementById('statOverdue').textContent = overdueRequests;
            document.getElementById('statResourceUsage').textContent = resourceUsage + '%';
            document.getElementById('statContentUploaded').textContent = content.length;
            
            // Update trend indicators
            const trendElement = document.querySelector('#statTotalRequests + small');
            if (trendElement) {
                const trend = Math.floor(Math.random() * 30) + 5;
                const isPositive = Math.random() > 0.3;
                trendElement.innerHTML = `<i class="bi bi-arrow-${isPositive ? 'up' : 'down'} me-1"></i>${trend}% from last period`;
                trendElement.className = isPositive ? 'text-success' : 'text-danger';
            }
        }
        
        // ===== CHARTS =====
        let charts = {};
        
        function initializeCharts() {
            // Requests Trend Chart
            const trendCtx = document.getElementById('requestsTrendChart').getContext('2d');
            charts.trend = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Requests',
                        data: [12, 19, 8, 15, 10, 5, 7],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Completions',
                        data: [8, 12, 6, 9, 7, 3, 4],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Categories Chart
            const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
            charts.categories = new Chart(categoriesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['News', 'Sports', 'Politics', 'Entertainment', 'Culture', 'Business'],
                    datasets: [{
                        data: [25, 20, 15, 18, 12, 10],
                        backgroundColor: [
                            '#4361ee',
                            '#2ecc71',
                            '#f39c12',
                            '#e74c3c',
                            '#3498db',
                            '#9b59b6'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
            
            // Performance Chart
            const performanceCtx = document.getElementById('performanceChart').getContext('2d');
            charts.performance = new Chart(performanceCtx, {
                type: 'radar',
                data: {
                    labels: ['Response Time', 'Completion Rate', 'Quality', 'Resource Efficiency', 'Cost Control', 'Client Satisfaction'],
                    datasets: [{
                        label: 'Current',
                        data: [85, 90, 78, 82, 75, 88],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.2)',
                        borderWidth: 2
                    }, {
                        label: 'Target',
                        data: [90, 95, 85, 85, 80, 90],
                        borderColor: '#2ecc71',
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
            
            // Utilization Chart
            const utilizationCtx = document.getElementById('utilizationChart').getContext('2d');
            charts.utilization = new Chart(utilizationCtx, {
                type: 'bar',
                data: {
                    labels: ['Reporters', 'Cameramen', 'Sound Tech', 'Drivers', 'Editors', 'Equipment'],
                    datasets: [{
                        label: 'Utilization %',
                        data: [85, 92, 78, 65, 88, 72],
                        backgroundColor: [
                            '#4361ee',
                            '#2ecc71',
                            '#f39c12',
                            '#e74c3c',
                            '#3498db',
                            '#9b59b6'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }
        
        function updateChartPeriod(period) {
            // Update active button
            document.querySelectorAll('#requestsTrendChart').previousElementSibling.querySelectorAll('.btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update chart data based on period
            let labels, requestData, completionData;
            
            switch(period) {
                case 'week':
                    labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    requestData = [12, 19, 8, 15, 10, 5, 7];
                    completionData = [8, 12, 6, 9, 7, 3, 4];
                    break;
                case 'month':
                    labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    requestData = [45, 52, 38, 47];
                    completionData = [35, 42, 30, 38];
                    break;
                case 'quarter':
                    labels = ['Month 1', 'Month 2', 'Month 3'];
                    requestData = [150, 180, 165];
                    completionData = [120, 145, 135];
                    break;
            }
            
            charts.trend.data.labels = labels;
            charts.trend.data.datasets[0].data = requestData;
            charts.trend.data.datasets[1].data = completionData;
            charts.trend.update();
        }
        
        // ===== PERFORMANCE TABLE =====
        function loadPerformanceTable() {
            const departments = [
                { name: 'News', requests: 45, completed: 38, avgTime: '2.5h', successRate: '84%', resourceUsage: '78%', contentOutput: 120, score: 85 },
                { name: 'Sports', requests: 32, completed: 28, avgTime: '1.8h', successRate: '88%', resourceUsage: '82%', contentOutput: 95, score: 88 },
                { name: 'Politics', requests: 28, completed: 24, avgTime: '3.2h', successRate: '86%', resourceUsage: '75%', contentOutput: 85, score: 82 },
                { name: 'Entertainment', requests: 25, completed: 22, avgTime: '2.1h', successRate: '88%', resourceUsage: '80%', contentOutput: 78, score: 86 },
                { name: 'Culture', requests: 20, completed: 18, avgTime: '2.8h', successRate: '90%', resourceUsage: '72%', contentOutput: 65, score: 84 },
                { name: 'Business', requests: 18, completed: 16, avgTime: '3.5h', successRate: '89%', resourceUsage: '68%', contentOutput: 55, score: 81 },
                { name: 'Technical', requests: 15, completed: 14, avgTime: '1.5h', successRate: '93%', resourceUsage: '85%', contentOutput: 42, score: 90 }
            ];
            
            const tableBody = document.getElementById('performanceTableBody');
            tableBody.innerHTML = '';
            
            departments.forEach(dept => {
                const scoreClass = dept.score >= 90 ? 'success' : dept.score >= 80 ? 'primary' : dept.score >= 70 ? 'warning' : 'danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${dept.name}</strong></td>
                    <td>${dept.requests}</td>
                    <td>${dept.completed}</td>
                    <td>${dept.avgTime}</td>
                    <td>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: ${dept.successRate}"></div>
                        </div>
                        <small>${dept.successRate}</small>
                    </td>
                    <td>
                        <div class="progress" style="height: 8px;">
                            <div class="progress-bar bg-info" style="width: ${dept.resourceUsage}"></div>
                        </div>
                        <small>${dept.resourceUsage}</small>
                    </td>
                    <td>${dept.contentOutput}</td>
                    <td>
                        <span class="badge bg-${scoreClass}">${dept.score}</span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // ===== REPORT FUNCTIONS =====
        function showFilterModal() {
            // Initialize Bootstrap modal
            const modal = new bootstrap.Modal(document.getElementById('filterModal'));
            modal.show();
        }
        
        function resetFilters() {
            document.getElementById('filterDepartment').selectedIndex = -1;
            document.getElementById('filterCategory').selectedIndex = -1;
            document.getElementById('filterPriority').selectedIndex = -1;
            document.getElementById('reportType').selectedIndex = 0;
            document.getElementById('reportMetrics').selectedIndex = -1;
            
            // Reset date range to last 30 days
            const startDate = moment().subtract(30, 'days');
            const endDate = moment();
            $('#filterDateRange').data('daterangepicker').setStartDate(startDate);
            $('#filterDateRange').data('daterangepicker').setEndDate(endDate);
            
            showToast('Filters Reset', 'All filters have been reset to default values', 'info');
        }
        
        function generateCustomReport() {
            showLoading(true);
            
            // Get filter values
            const departments = Array.from(document.getElementById('filterDepartment').selectedOptions).map(opt => opt.value);
            const categories = Array.from(document.getElementById('filterCategory').selectedOptions).map(opt => opt.value);
            const priorities = Array.from(document.getElementById('filterPriority').selectedOptions).map(opt => opt.value);
            const reportType = document.getElementById('reportType').value;
            const metrics = Array.from(document.getElementById('reportMetrics').selectedOptions).map(opt => opt.value);
            
            const dateRange = $('#filterDateRange').data('daterangepicker');
            const startDate = dateRange.startDate.format('YYYY-MM-DD');
            const endDate = dateRange.endDate.format('YYYY-MM-DD');
            
            // Simulate report generation
            setTimeout(() => {
                showLoading(false);
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('filterModal')).hide();
                
                // Show success message
                showToast('Report Generated', 
                    `Custom report generated for ${startDate} to ${endDate}`, 
                    'success');
                
                // Update charts with filtered data (simulated)
                updateReports();
            }, 2000);
        }
        
        function updateReports() {
            // Get date range from picker
            const dateRange = $('#dateRangePicker').data('daterangepicker');
            if (!dateRange) return;
            
            const startDate = dateRange.startDate.format('YYYY-MM-DD');
            const endDate = dateRange.endDate.format('YYYY-MM-DD');
            
            showToast('Updating Reports', 
                `Loading data from ${startDate} to ${endDate}`, 
                'info');
            
            // Simulate loading new data
            setTimeout(() => {
                loadStatistics();
                showToast('Reports Updated', 'All charts and statistics have been updated', 'success');
            }, 1000);
        }
        
        function exportReport(format) {
            showLoading(true);
            
            setTimeout(() => {
                showLoading(false);
                
                switch(format) {
                    case 'pdf':
                        showToast('Export Started', 'PDF report is being generated and downloaded', 'info');
                        // In a real app, this would generate and download a PDF
                        break;
                    case 'excel':
                        showToast('Export Started', 'Excel file is being generated and downloaded', 'info');
                        // In a real app, this would generate and download an Excel file
                        break;
                    case 'csv':
                        showToast('Export Started', 'CSV file is being generated and downloaded', 'info');
                        // In a real app, this would generate and download a CSV file
                        break;
                }
            }, 1500);
        }
        
        function saveSchedule() {
            const name = document.getElementById('scheduleName').value;
            const frequency = document.getElementById('scheduleFrequency').value;
            
            if (!name) {
                showToast('Error', 'Please enter a report name', 'warning');
                return;
            }
            
            // Save schedule to localStorage
            const schedules = JSON.parse(localStorage.getItem('reportSchedules') || '[]');
            schedules.push({
                id: Date.now(),
                name: name,
                frequency: frequency,
                active: document.getElementById('scheduleActive').checked,
                createdAt: new Date().toISOString()
            });
            
            localStorage.setItem('reportSchedules', JSON.stringify(schedules));
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('scheduleModal')).hide();
            
            showToast('Schedule Saved', `Report "${name}" scheduled for ${frequency} delivery`, 'success');
        }
        
        // ===== UI HELPERS =====
        function showLoading(show) {
            document.getElementById('loadingOverlay').classList.toggle('show', show);
        }
        
        function showToast(title, message, type) {
            const container = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast align-items-center text-bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <strong>${title}:</strong> ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            container.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // Remove toast after it's hidden
            toast.addEventListener('hidden.bs.toast', function () {
                toast.remove();
            });
        }
    </script>
</body>
</html>