<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Registration Pending - Amhara Media</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 20px;
        }
        
        .pending-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }
        
        .pending-icon {
            font-size: 5rem;
            color: #f39c12;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .status-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .btn-check-status {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
        }
        
        .btn-check-status:hover {
            background: linear-gradient(135deg, #2980b9, #21618c);
        }
    </style>
</head>
<body>
    <div class="pending-card">
        <div class="pending-icon">
            <i class="bi bi-clock-history"></i>
        </div>
        
        <h2 class="mb-3">Admin Approval Required</h2>
        
        <p class="text-muted mb-4">
            Your administrator account has been created successfully, but it requires 
            approval from the Master Administrator before you can access the system.
        </p>
        
        <!-- User Info -->
        <div class="card mb-4">
            <div class="card-body text-start">
                <h6 class="card-title mb-3">
                    <i class="bi bi-person-circle me-2"></i>
                    Account Information
                </h6>
                <div class="row">
                    <div class="col-6">
                        <small class="text-muted d-block">Email:</small>
                        <strong id="userEmail">Loading...</strong>
                    </div>
                    <div class="col-6">
                        <small class="text-muted d-block">Status:</small>
                        <span class="badge bg-warning" id="userStatus">Pending</span>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <small class="text-muted d-block">Registration ID:</small>
                        <small class="text-muted" id="registrationId">Loading...</small>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- What happens next -->
        <div class="alert alert-warning mb-4">
            <h6>
                <i class="bi bi-info-circle me-2"></i>
                What happens next?
            </h6>
            <ul class="mb-0 ps-3 text-start">
                <li>Master admin will review your request</li>
                <li>You'll receive an email notification when approved</li>
                <li>Typical approval time: 24-48 hours</li>
                <li>You can login immediately after approval</li>
            </ul>
        </div>
        
       <!-- Action Buttons - Add Check Status button -->
<div class="d-grid gap-2">
    <button class="btn btn-primary" onclick="checkStatus()">
        <i class="bi bi-arrow-clockwise me-1"></i>
        Check Approval Status
    </button>
    <button class="btn btn-outline-primary" onclick="window.location.href='login.html'">
        <i class="bi bi-box-arrow-in-right me-1"></i>
        Go to Login
    </button>
    <button class="btn btn-outline-secondary" onclick="window.location.href='index.html'">
        <i class="bi bi-house me-1"></i>
        Return to Home
    </button>
</div>
        
        <!-- Auto-check notice -->
        <div class="mt-4 text-muted">
            <small>
                <i class="bi bi-info-circle me-1"></i>
                Status will auto-check every 30 seconds
            </small>
        </div>
    </div>
    
    <script>
        // Get email from URL
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get('email');
        
        // Generate registration ID
        function generateRegistrationId(email) {
            return 'REG-' + btoa(email).substring(0, 8).toUpperCase();
        }
        
        // Function to check status
        function checkStatus() {
            if (!email) {
                alert('No email found in URL');
                return;
            }
            
            const realUsers = JSON.parse(localStorage.getItem('amecoRealUsers') || '{}');
            const user = realUsers[email];
            
            if (!user) {
                alert('Account not found. Please register again.');
                window.location.href = 'register.html';
                return;
            }
            
            const statusBadge = document.getElementById('userStatus');
            const checkBtn = document.querySelector('.btn-check-status');
            
            // Update button to show loading
            const originalText = checkBtn.innerHTML;
            checkBtn.innerHTML = '<i class="bi bi-arrow-clockwise spin me-1"></i> Checking...';
            checkBtn.disabled = true;
            
            // Simulate network delay
            setTimeout(() => {
                switch(user.status) {
                    case 'active':
                        statusBadge.textContent = 'Approved ✓';
                        statusBadge.className = 'badge bg-success';
                        
                        // Show success and redirect
                        const approvedMsg = `Congratulations! Your admin account has been approved.\n\n` +
                                          `Approved by: ${user.approvedBy || 'Master Admin'}\n` +
                                          `Approved on: ${user.approvedAt ? new Date(user.approvedAt).toLocaleString() : 'Recently'}`;
                        
                        alert(approvedMsg);
                        window.location.href = 'login.html?email=' + encodeURIComponent(email);
                        break;
                        
                    case 'rejected':
                        statusBadge.textContent = 'Rejected ✗';
                        statusBadge.className = 'badge bg-danger';
                        
                        const rejectionMsg = `Your admin request was rejected.\n\n` +
                                           `Reason: ${user.rejectionReason || 'Not specified'}\n` +
                                           `Rejected by: ${user.rejectedBy || 'Master Admin'}`;
                        
                        alert(rejectionMsg);
                        break;
                        
                    case 'pending':
                        statusBadge.textContent = 'Pending ⏳';
                        statusBadge.className = 'badge bg-warning';
                        alert('Your account is still pending approval. Please check back later.');
                        break;
                        
                    default:
                        alert('Unknown account status. Please contact support.');
                }
                
                // Reset button
                checkBtn.innerHTML = originalText;
                checkBtn.disabled = false;
            }, 1000);
        }
        
        // Initialize page
        if (email) {
            // Display email
            document.getElementById('userEmail').textContent = email;
            
            // Generate and display registration ID
            const regId = generateRegistrationId(email);
            document.getElementById('registrationId').textContent = regId;
            
            // Check status immediately
            checkStatus();
            
            // Auto-check every 30 seconds
            setInterval(checkStatus, 30000);
            
            // Add spin animation style
            const style = document.createElement('style');
            style.textContent = `
                .spin {
                    animation: spin 1s linear infinite;
                    display: inline-block;
                }
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
        } else {
            // No email in URL, redirect to register
            alert('No registration information found. Please register first.');
            window.location.href = 'register.html';
        }
    </script>
</body>
</html>